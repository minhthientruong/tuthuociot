<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard T·ªß Thu·ªëc AIoT</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* Modal Styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .modal-content {
        background: white;
        padding: 24px;
        border-radius: 12px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }
      .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 12px;
        color: #1e293b;
      }
      .modal-body {
        color: #64748b;
        margin-bottom: 24px;
        line-height: 1.5;
      }
      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
      }
      .btn-modal {
        padding: 8px 20px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s;
      }
      .btn-modal-primary {
        background: #3b82f6;
        color: white;
      }
      .btn-modal-primary:hover {
        background: #2563eb;
      }
      .btn-modal-secondary {
        background: #e2e8f0;
        color: #475569;
      }
      .btn-modal-secondary:hover {
        background: #cbd5e1;
      }
      .hidden {
        display: none !important;
      }

      /* Disabled Button Style */
      .btn-submit:disabled {
        background: #94a3b8;
        cursor: not-allowed;
        opacity: 0.7;
      }

      .avatar-preview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }
      .avatar-preview-grid img {
        width: 100%;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #ddd;
      }

      /* Camera Styles */
      .btn-camera {
        background-color: #3b82f6;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        margin-left: 10px;
        font-weight: 500;
      }
      .btn-camera:hover {
        background-color: #2563eb;
      }
      #camera-interface {
        margin-top: 15px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        padding: 10px;
        background: #f8fafc;
        text-align: center;
      }
      #camera-feed {
        width: 100%;
        max-width: 400px;
        border-radius: 8px;
        background: #000;
      }
      .camera-controls {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        gap: 10px;
      }
      .btn-capture {
        background-color: #10b981;
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 20px;
        cursor: pointer;
      }
      .btn-close-camera {
        background-color: #ef4444;
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <nav class="sidebar">
      <div>
        <div class="sidebar-header">
          <h2>T·ªß Thu·ªëc AIoT</h2>
        </div>
        <ul class="sidebar-nav">
          <li>
            <a href="#" class="nav-link active" data-page="page-dashboard"
              >T·ªïng quan</a
            >
          </li>
          <li>
            <a href="#" class="nav-link" data-page="page-schedule"
              >L·ªãch c√†i ƒë·∫∑t</a
            >
          </li>
          <li>
            <a href="#" class="nav-link" data-page="page-stats">Th·ªëng k√™</a>
          </li>
          <li>
            <a href="#" class="nav-link" data-page="page-medicines"
              >Qu·∫£n l√Ω thu·ªëc</a
            >
          </li>
          <li>
            <a href="#" class="nav-link" data-page="page-users"
              >Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a
            >
          </li>
          <li>
            <a href="#">C√†i ƒë·∫∑t</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="main-content">
      <header>
        <h1 id="page-title">B·∫£ng ƒëi·ªÅu khi·ªÉn</h1>
        <div class="header-info">
          <span id="current-date-time"></span>
        </div>
      </header>

      <!-- Photo Requirement Modal -->
      <div id="photo-requirement-modal" class="modal-overlay hidden">
        <div class="modal-content">
          <h3 class="modal-title">Y√™u c·∫ßu ch·ª•p ·∫£nh</h3>
          <div class="modal-body">
            ƒê·ªÉ ƒë·∫£m b·∫£o ƒë·ªô ch√≠nh x√°c khi nh·∫≠n di·ªán khu√¥n m·∫∑t, b·∫°n c·∫ßn cung c·∫•p ƒë·ªß
            <strong>5 ·∫£nh</strong> khu√¥n m·∫∑t ·ªü c√°c g√≥c ƒë·ªô kh√°c nhau.
          </div>
          <div class="modal-actions">
            <button id="modal-cancel-btn" class="btn-modal btn-modal-secondary">
              Cancel
            </button>
            <button id="modal-confirm-btn" class="btn-modal btn-modal-primary">
              ƒê√£ hi·ªÉu
            </button>
          </div>
        </div>
      </div>

      <main class="page-content active" id="page-dashboard">
        <div class="dashboard-grid">
          <section class="card status-card">
            <div class="card-header">
              <span>Tr·∫°ng th√°i T·ªß Thu·ªëc</span>
              <div class="card-header-badge">
                <span
                  class="status-indicator online"
                  id="header-status-indicator"
                ></span>
              </div>
            </div>
            <div class="status-grid">
              <div class="status-item">
                <div class="label">Tr·∫°ng th√°i</div>
                <div class="value online" id="device-status">--</div>
              </div>
              <div class="status-item">
                <div class="label">K·∫øt n·ªëi</div>
                <div class="value">Wi-Fi</div>
              </div>
              <div class="status-item">
                <div class="label">Nhi·ªát ƒë·ªô</div>
                <div class="value temp" id="device-temp">-- ¬∞C</div>
              </div>
              <div class="status-item">
                <div class="label">ƒê·ªô ·∫©m</div>
                <div class="value humid" id="device-humidity">-- %</div>
              </div>
            </div>
          </section>
          <section class="card alerts-card">
            <div class="card-header">
              <span>C·∫£nh b√°o & T·ªìn kho</span>
              <div style="display: flex; align-items: center; gap: 10px">
                <button
                  id="clear-alerts-btn"
                  style="
                    background: none;
                    border: none;
                    cursor: pointer;
                    color: #ef4444;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  "
                  title="X√≥a t·∫•t c·∫£ c·∫£nh b√°o"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path
                      d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                    ></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
                <div class="card-header-badge">
                  <span class="alert-count" id="alert-count">0</span>
                </div>
              </div>
            </div>
            <ul class="alert-list" id="alert-list">
              <li class="no-alerts">
                <span class="icon"></span>
                <div>Kh√¥ng c√≥ c·∫£nh b√°o n√†o!</div>
              </li>
            </ul>
            <div
              class="card-footer-action"
              id="alert-expand-container"
              style="
                display: none;
                text-align: center;
                padding: 10px;
                cursor: pointer;
                color: #3b82f6;
                font-weight: 500;
              "
            >
              <span id="alert-expand-btn">Xem th√™m</span>
            </div>
          </section>
          <section class="card timeline-card">
            <div class="card-header">
              <span>L·ªãch nh·∫Øc nh·ªü h√¥m nay</span>
              <div class="card-header-badge">
                <span class="timeline-count" id="timeline-count">0</span>
              </div>
            </div>
            <ul class="timeline" id="timeline-list">
              <li class="no-timeline">
                <span class="icon"></span>
                <div>Kh√¥ng c√≥ ho·∫°t ƒë·ªông n√†o h√¥m nay!</div>
              </li>
            </ul>
          </section>
          <section class="card stats-card">
            <div class="card-header">
              <span>Th·ªëng k√™ Tu√¢n th·ªß (7 ng√†y)</span>
              <div class="card-header-badge">
                <span class="stats-avg" id="stats-average">--</span>
              </div>
            </div>
            <div id="stats-users-container">
              <!-- User stats will be injected here -->
            </div>
          </section>
        </div>
      </main>

      <main class="page-content" id="page-schedule">
        <div class="card add-schedule-card">
          <div class="card-header">
            <span>Th√™m l·ªãch u·ªëng thu·ªëc m·ªõi</span>
            <div class="card-header-info">
              <span>T·∫°o l·ªãch nh·∫Øc nh·ªü t·ª± ƒë·ªông</span>
            </div>
          </div>
          <form id="add-schedule-form" class="schedule-form">
            <div class="form-group">
              <label for="user-select-dropdown">
                <span>Ch·ªçn ng∆∞·ªùi d√πng:</span>
              </label>
              <select id="user-select-dropdown" name="user"></select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="weekdays-select">
                  <span>Th·ª© trong tu·∫ßn:</span>
                </label>
                <div class="weekday-selector" id="weekdays-container">
                  <label class="weekday-item">
                    <input type="checkbox" name="weekdays" value="1" /> T2
                  </label>
                  <label class="weekday-item">
                    <input type="checkbox" name="weekdays" value="2" /> T3
                  </label>
                  <label class="weekday-item">
                    <input type="checkbox" name="weekdays" value="3" /> T4
                  </label>
                  <label class="weekday-item">
                    <input type="checkbox" name="weekdays" value="4" /> T5
                  </label>
                  <label class="weekday-item">
                    <input type="checkbox" name="weekdays" value="5" /> T6
                  </label>
                  <label class="weekday-item">
                    <input type="checkbox" name="weekdays" value="6" /> T7
                  </label>
                  <label class="weekday-item">
                    <input type="checkbox" name="weekdays" value="0" /> CN
                  </label>
                </div>
              </div>

              <div class="form-group">
                <label for="usage-duration">
                  <span>Th·ªùi gian s·ª≠ d·ª•ng:</span>
                </label>
                <div class="duration-input-group">
                  <input
                    type="number"
                    id="usage-duration"
                    name="usageDuration"
                    min="1"
                    max="365"
                    placeholder="30"
                    required
                  />
                  <span class="duration-unit">ng√†y</span>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="period-select">
                <span>Bu·ªïi u·ªëng:</span>
              </label>
              <div class="period-input-container">
                <select id="period-select" name="period" required>
                  <option value="S√°ng">S√°ng (kho·∫£ng 8:00)</option>
                  <option value="Tr∆∞a">Tr∆∞a (kho·∫£ng 12:00)</option>
                  <option value="Chi·ªÅu">Chi·ªÅu (kho·∫£ng 17:00)</option>
                  <option value="T·ªëi">T·ªëi (kho·∫£ng 20:00)</option>
                  <option value="custom">T√πy ch·ªânh gi·ªù</option>
                </select>
                <div
                  class="custom-time-input hidden"
                  id="custom-time-container"
                >
                  <label for="custom-time-input">
                    <span>Nh·∫≠p gi·ªù:</span>
                  </label>
                  <input
                    type="time"
                    id="custom-time-input"
                    name="customTime"
                    placeholder="HH:MM"
                  />
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="medicine-category-select">
                <span>Danh m·ª•c thu·ªëc:</span>
              </label>
              <select id="medicine-category-select" name="medicineCategory">
                <option value="">Ch·ªçn lo·∫°i thu·ªëc...</option>
                <option value="pain-relief">Thu·ªëc gi·∫£m ƒëau</option>
                <option value="cold-flu">Thu·ªëc c·∫£m c√∫m</option>
                <option value="digestive">Thu·ªëc ti√™u h√≥a</option>
                <option value="heart">Thu·ªëc tim m·∫°ch</option>
                <option value="diabetes">Thu·ªëc ti·ªÉu ƒë∆∞·ªùng</option>
                <option value="blood-pressure">Thu·ªëc huy·∫øt √°p</option>
                <option value="vitamins">Vitamin & th·ª±c ph·∫©m ch·ª©c nƒÉng</option>
                <option value="antibiotics">Thu·ªëc kh√°ng sinh</option>
                <option value="other">Thu·ªëc kh√°c</option>
              </select>
            </div>

            <div class="form-group">
              <label for="medicine-name-input">
                <span>T√™n thu·ªëc c·ª• th·ªÉ:</span>
              </label>
              <input
                type="text"
                id="medicine-name-input"
                name="medicineName"
                placeholder="V√≠ d·ª•: Paracetamol 500mg"
              />
            </div>

            <div class="form-group">
              <label>
                <span>Thu·ªëc ƒë√£ ch·ªçn:</span>
              </label>
              <div
                class="selected-medicines"
                id="selected-medicines-container"
              ></div>
            </div>

            <button type="submit" class="btn-submit">
              <span>L∆∞u l·ªãch u·ªëng thu·ªëc</span>
            </button>
          </form>
        </div>
        <div class="card">
          <div class="card-header">L·ªãch ƒë√£ c√†i ƒë·∫∑t (S·∫Øp t·ªõi)</div>
          <ul class="schedule-list" id="schedule-list"></ul>
        </div>
      </main>

      <main class="page-content" id="page-stats">
        <div class="card chart-card">
          <div class="card-header">
            <span>Bi·ªÉu ƒë·ªì tu√¢n th·ªß 7 ng√†y qua</span>
            <div class="card-header-info">
              <span>So s√°nh hi·ªáu qu·∫£ tu√¢n th·ªß c·ªßa c√°c th√†nh vi√™n</span>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="complianceChart"></canvas>
          </div>
        </div>
      </main>

      <main class="page-content" id="page-medicines">
        <!-- Medicine Inventory Dashboard -->
        <div class="medicine-inventory-card">
          <div class="card-header">
            <span>T·ªïng quan t·ªìn kho thu·ªëc</span>
            <div class="card-header-info">
              <span>Theo d√µi s·ªë l∆∞·ª£ng v√† t√¨nh tr·∫°ng thu·ªëc</span>
            </div>
          </div>
          <div class="inventory-grid" id="inventory-grid">
            <!-- Inventory items will be rendered here -->
          </div>
        </div>

        <div class="card add-medicine-card">
          <div class="card-header">
            <span>Th√™m thu·ªëc m·ªõi</span>
            <div class="card-header-info">
              <span>Qu·∫£n l√Ω kho thu·ªëc trong t·ªß</span>
            </div>
          </div>
          <form id="add-medicine-form" class="schedule-form">
            <div class="form-row">
              <div class="form-group">
                <label for="medicine-name-input">
                  <span>T√™n thu·ªëc:</span>
                </label>
                <input
                  type="text"
                  id="medicine-name-input"
                  name="medicineName"
                  placeholder="V√≠ d·ª•: Paracetamol, Vitamin C..."
                  required
                />
              </div>
              <div class="form-group">
                <label for="medicine-dosage-input">
                  <span>Li·ªÅu l∆∞·ª£ng:</span>
                </label>
                <input
                  type="text"
                  id="medicine-dosage-input"
                  name="dosage"
                  placeholder="V√≠ d·ª•: 500mg, 1 vi√™n..."
                  required
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="medicine-quantity-input">
                  <span>S·ªë l∆∞·ª£ng:</span>
                </label>
                <input
                  type="number"
                  id="medicine-quantity-input"
                  name="quantity"
                  placeholder="S·ªë vi√™n/li·ªÅu"
                  min="0"
                />
              </div>
              <div class="form-group">
                <label for="medicine-threshold-input">
                  <span>Ng∆∞·ª°ng c·∫£nh b√°o:</span>
                </label>
                <input
                  type="number"
                  id="medicine-threshold-input"
                  name="minThreshold"
                  placeholder="C·∫£nh b√°o khi c√≤n X vi√™n"
                  min="1"
                  value="5"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="medicine-expiry-input">
                <span>Ng√†y h·∫øt h·∫°n:</span>
              </label>
              <input type="date" id="medicine-expiry-input" name="expiryDate" />
            </div>
            <div class="form-group">
              <label for="medicine-instructions-input">
                <span>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</span>
              </label>
              <textarea
                id="medicine-instructions-input"
                name="instructions"
                placeholder="V√≠ d·ª•: U·ªëng sau ƒÉn, tr√°nh ti·∫øp x√∫c √°nh n·∫Øng..."
                rows="3"
              ></textarea>
            </div>
            <button type="submit" class="btn-submit">
              <span>L∆∞u thu·ªëc</span>
            </button>
          </form>
        </div>
        <div class="card medicine-list-card">
          <div class="card-header">
            <span>Danh s√°ch thu·ªëc trong t·ªß</span>
            <div class="card-header-badge">
              <span class="medicine-count" id="medicine-count">0</span>
            </div>
          </div>
          <ul class="medicine-list" id="medicine-list"></ul>
        </div>
      </main>

      <main class="page-content" id="page-users">
        <div class="card add-user-card">
          <div class="card-header">
            <span>Th√™m ng∆∞·ªùi d√πng m·ªõi</span>
            <div class="card-header-info">
              <span>Qu·∫£n l√Ω th√†nh vi√™n gia ƒë√¨nh</span>
            </div>
          </div>
          <form id="add-user-form" class="schedule-form">
            <div class="form-group">
              <label for="user-name-input">
                <span>T√™n ng∆∞·ªùi d√πng:</span>
              </label>
              <input
                type="text"
                id="user-name-input"
                name="userName"
                placeholder="V√≠ d·ª•: Con Trai, Ch·ªã G√°i..."
                required
              />
            </div>
            <div class="form-group">
              <label for="user-avatar-file">
                <span>Upload ·∫£nh khu√¥n m·∫∑t (4-5 ·∫£nh):</span>
              </label>
              <div class="avatar-upload-container">
                <input
                  type="file"
                  id="user-avatar-file"
                  name="avatarFiles"
                  accept="image/*"
                  class="file-input"
                  multiple
                />
                <label for="user-avatar-file" class="file-upload-btn">
                  <span>Ch·ªçn ·∫£nh</span>
                </label>
                <button type="button" class="btn-camera" id="start-camera-btn">
                  üì∑ Ch·ª•p ·∫£nh
                </button>

                <div id="camera-interface" class="hidden">
                  <video id="camera-feed" autoplay playsinline></video>
                  <div class="camera-controls">
                    <button type="button" id="capture-btn" class="btn-capture">
                      Ch·ª•p
                    </button>
                    <button
                      type="button"
                      id="close-camera-btn"
                      class="btn-close-camera"
                    >
                      H·ªßy
                    </button>
                  </div>
                  <canvas id="camera-canvas" style="display: none"></canvas>
                </div>

                <div
                  class="avatar-preview-grid hidden"
                  id="avatar-preview-container"
                >
                  <!-- Images will be inserted here -->
                </div>
                <button
                  type="button"
                  class="remove-avatar hidden"
                  id="remove-avatar"
                >
                  X X√≥a t·∫•t c·∫£
                </button>
              </div>
            </div>
            <div class="form-group">
              <label for="user-avatar-input">
                <span>Ho·∫∑c nh·∫≠p link ·∫£nh:</span>
              </label>
              <input
                type="text"
                id="user-avatar-input"
                name="avatarUrl"
                placeholder="https://i.pravatar.cc/150?img=... (t√πy ch·ªçn)"
              />
            </div>
            <button type="submit" class="btn-submit">
              <span>L∆∞u ng∆∞·ªùi d√πng</span>
            </button>
          </form>
        </div>
        <div class="card user-list-card">
          <div class="card-header">
            <span>Danh s√°ch ng∆∞·ªùi d√πng hi·ªán t·∫°i</span>
            <div class="card-header-badge">
              <span class="user-count" id="user-count">0</span>
            </div>
          </div>
          <ul class="user-list" id="user-list"></ul>
        </div>
      </main>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="client.js"></script>
  </body>
</html>
